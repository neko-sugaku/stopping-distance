<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è»Šã®åœæ­¢è·é›¢ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'M PLUS 1p', sans-serif;
        }
        .result-bar-container {
            display: flex;
            width: 100%;
            height: 40px;
            border-radius: 0.5rem;
            overflow: hidden;
            background-color: #374151;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.2);
        }
        .result-bar {
            transition: width 0.3s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.875rem;
            white-space: nowrap;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500">åœæ­¢è·é›¢ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
            <p class="mt-2 text-gray-300">ã€Œã‚ã£ï¼ã€ã¨æ€ã£ã¦ã‹ã‚‰ã€è»ŠãŒå®Œå…¨ã«æ­¢ã¾ã‚‹ã¾ã§ã®è·é›¢ã¯ï¼Ÿ</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-2xl">
                <h2 class="text-2xl font-bold mb-6 border-b-2 border-yellow-400 pb-2">æ¡ä»¶ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>

                <!-- é€Ÿåº¦ -->
                <div class="mb-6">
                    <label for="speed" class="block mb-2 font-bold text-lg">
                        <span class="text-yellow-400">â‘ </span> è»Šã®é€Ÿåº¦ (km/h)
                    </label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="speed-slider" min="0" max="200" value="40" class="w-full h-3 bg-gray-700 rounded-lg appearance-none cursor-pointer range-lg">
                        <input type="number" id="speed-input" min="0" max="200" value="40" class="w-24 bg-gray-700 text-white font-bold text-center rounded-lg p-2">
                    </div>
                </div>

                <!-- åå¿œæ™‚é–“ -->
                <div class="mb-6">
                    <label for="reaction" class="block mb-2 font-bold text-lg">
                        <span class="text-yellow-400">â‘¡</span> åå¿œæ™‚é–“ (ç§’)
                    </label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="reaction-slider" min="0.1" max="2.0" step="0.1" value="1.0" class="w-full h-3 bg-gray-700 rounded-lg appearance-none cursor-pointer range-lg">
                        <input type="number" id="reaction-input" min="0.1" max="2.0" step="0.1" value="1.0" class="w-24 bg-gray-700 text-white font-bold text-center rounded-lg p-2">
                    </div>
                    <p class="text-sm text-gray-400 mt-2">â€»å±é™ºã‚’å¯ŸçŸ¥ã—ã¦ã‹ã‚‰ãƒ–ãƒ¬ãƒ¼ã‚­ã‚’è¸ã‚€ã¾ã§ã®æ™‚é–“ã€‚ä¸€èˆ¬çš„ã«ã¯0.75ç§’ã€œ1ç§’ã§ã™ã€‚</p>
                </div>

                <!-- è·¯é¢çŠ¶æ³ -->
                <div class="mb-6">
                    <label for="surface" class="block mb-2 font-bold text-lg">
                        <span class="text-yellow-400">â‘¢</span> è·¯é¢çŠ¶æ³ (æ‘©æ“¦ä¿‚æ•°Î¼)
                    </label>
                    <select id="surface" class="w-full bg-gray-700 text-white rounded-lg p-3 cursor-pointer">
                        <option value="0.8">ä¹¾ã„ãŸé“è·¯ (ã‚¢ã‚¹ãƒ•ã‚¡ãƒ«ãƒˆ) (Î¼=0.8)</option>
                        <option value="0.6">æ¿¡ã‚ŒãŸé“è·¯ (é›¨) (Î¼=0.6)</option>
                        <option value="0.4">ç ‚åˆ©é“ (Î¼=0.4)</option>
                        <option value="0.25">é›ªé“ (Î¼=0.25)</option>
                        <option value="0.1">å‡çµã—ãŸé“è·¯ (ã‚¢ã‚¤ã‚¹ãƒãƒ¼ãƒ³) (Î¼=0.1)</option>
                    </select>
                </div>
                
                <!-- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ãƒœã‚¿ãƒ³ -->
                <div class="mt-8">
                     <button id="start-simulation-btn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-300">
                        ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
                    </button>
                </div>
            </div>

            <!-- çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-2xl flex flex-col justify-between">
                <div>
                    <h2 class="text-2xl font-bold mb-4 border-b-2 border-red-500 pb-2">è¨ˆç®—çµæœ</h2>
                    
                    <div class="space-y-3">
                        <div>
                            <span class="font-bold text-blue-400">ç©ºèµ°è·é›¢:</span>
                            <span id="thinking-distance" class="text-2xl font-bold ml-2">0.0 m</span>
                            <p class="text-xs text-gray-400" id="thinking-formula">= 0.0 m/s Ã— 0.0 s</p>
                        </div>
                        <div>
                            <span class="font-bold text-red-400">åˆ¶å‹•è·é›¢:</span>
                            <span id="braking-distance" class="text-2xl font-bold ml-2">0.0 m</span>
                            <p class="text-xs text-gray-400" id="braking-formula">= (0.0 m/s)Â² / (2 Ã— 0.0 Ã— 9.8)</p>
                             <p class="text-xs text-gray-400 mt-1">â€»åˆ¶å‹•è·é›¢ã¯é€Ÿåº¦ã®<span class="font-bold text-yellow-300">2ä¹—</span>ã«æ¯”ä¾‹ã™ã‚‹ (äºŒæ¬¡é–¢æ•°)</p>
                        </div>
                        <div class="border-t border-gray-600 pt-3 mt-3">
                            <span class="font-bold text-xl text-yellow-400">åœæ­¢è·é›¢:</span>
                            <span id="stopping-distance" class="text-5xl font-black ml-2">0.0 m</span>
                            <p class="text-xs text-gray-400" id="stopping-formula">= 0.0 m + 0.0 m</p>
                        </div>
                    </div>

                    <div class="mt-6">
                        <h3 class="font-bold mb-2">è·é›¢ã®å†…è¨³:</h3>
                        <div class="result-bar-container">
                            <div id="thinking-bar" class="result-bar bg-blue-500"></div>
                            <div id="braking-bar" class="result-bar bg-red-500"></div>
                        </div>
                         <div class="flex justify-between text-xs mt-1 text-gray-400">
                            <span>ç©ºèµ°</span>
                            <span>åˆ¶å‹•</span>
                        </div>
                    </div>
                </div>

                <div id="comment-box" class="mt-6 text-center bg-gray-900 p-4 rounded-lg border-2 border-dashed border-gray-600 transition-all duration-300">
                    <p id="comment-example" class="text-xl font-bold text-yellow-300"></p>
                    <p id="comment-text" class="text-md text-gray-300 mt-1"></p>
                </div>
            </div>
        </main>
        
        <!-- Simulation Section -->
        <section id="simulation-section" class="mt-8 bg-gray-800 p-6 rounded-2xl shadow-2xl">
            <canvas id="simulation-canvas" width="1000" height="120" class="bg-gray-700 rounded-lg w-full"></canvas>
            <div class="flex justify-center items-center space-x-6 mt-4 text-sm">
                <div class="flex items-center"><span class="w-4 h-4 bg-blue-400 rounded-sm mr-2"></span>ç©ºèµ°è·é›¢</div>
                <div class="flex items-center"><span class="w-4 h-4 bg-red-400 rounded-sm mr-2"></span>åˆ¶å‹•è·é›¢</div>
                <div class="flex items-center"><span class="w-4 h-4 bg-yellow-400 rounded-sm mr-2"></span>åœæ­¢è·é›¢</div>
            </div>
             <div class="text-center mt-2 text-gray-400 text-xs">
                <p>âš ï¸ = å±é™ºèªçŸ¥ / ğŸš« = ãƒ–ãƒ¬ãƒ¼ã‚­é–‹å§‹</p>
            </div>
        </section>
        
        <!-- Quiz Section -->
        <section id="quiz-section" class="mt-8 bg-gray-800 p-6 rounded-2xl shadow-2xl">
            <h2 class="text-2xl font-bold mb-4 border-b-2 border-green-400 pb-2">å­¦ç¿’ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰ ğŸ§ </h2>
            <p class="text-gray-300 mb-4">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§å­¦ã‚“ã çŸ¥è­˜ã‚’è©¦ã—ã¦ã¿ã‚ˆã†ï¼äºŒæ¬¡é–¢æ•°ã®è¨ˆç®—ã¯ã§ãã‚‹ã‹ãªï¼Ÿ</p>
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 mb-4">
                <button id="prediction-quiz-btn" class="flex-1 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">åœæ­¢è·é›¢ã‚’äºˆæ¸¬ã—ã‚ˆã†ï¼</button>
                <button id="reverse-quiz-btn" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg">å®‰å…¨ãªé€Ÿåº¦ã‚’é€†ç®—ã—ã‚ˆã†ï¼</button>
            </div>
            <div id="quiz-content" class="bg-gray-900 p-4 rounded-lg border-2 border-dashed border-gray-600 min-h-[150px] flex items-center justify-center">
                <p class="text-gray-400">ä¸Šã®ãƒœã‚¿ãƒ³ã‹ã‚‰æŒ‘æˆ¦ã—ãŸã„ã‚¯ã‚¤ã‚ºã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
            </div>
        </section>

    </div>

    <script>
        // DOMè¦ç´ ã®å–å¾—
        const speedSlider = document.getElementById('speed-slider');
        const speedInput = document.getElementById('speed-input');
        const reactionSlider = document.getElementById('reaction-slider');
        const reactionInput = document.getElementById('reaction-input');
        const surfaceSelect = document.getElementById('surface');

        const thinkingDistEl = document.getElementById('thinking-distance');
        const brakingDistEl = document.getElementById('braking-distance');
        const stoppingDistEl = document.getElementById('stopping-distance');
        
        const thinkingFormulaEl = document.getElementById('thinking-formula');
        const brakingFormulaEl = document.getElementById('braking-formula');
        const stoppingFormulaEl = document.getElementById('stopping-formula');

        const thinkingBar = document.getElementById('thinking-bar');
        const brakingBar = document.getElementById('braking-bar');
        
        const commentExampleEl = document.getElementById('comment-example');
        const commentTextEl = document.getElementById('comment-text');
        
        const startSimBtn = document.getElementById('start-simulation-btn');
        const canvas = document.getElementById('simulation-canvas');
        const ctx = canvas.getContext('2d');

        // Quiz elements
        const predictionQuizBtn = document.getElementById('prediction-quiz-btn');
        const reverseQuizBtn = document.getElementById('reverse-quiz-btn');
        const quizContentEl = document.getElementById('quiz-content');
        let quizCorrectAnswer = null;


        // å®šæ•°
        const GRAVITY = 9.8;

        // Global variables for simulation
        let animationFrameId = null;
        let currentThinkingDistance = 0;
        let currentBrakingDistance = 0;
        let currentStoppingDistance = 0;

        // ä¾‹ã¨ã‚³ãƒ¡ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆ
        const comments = [
            { limit: 10, example: "ä¹—ç”¨è»Š ç´„2å°åˆ†ï¼", text: "è¿‘ãã«è¦‹ãˆã¦ã‚‚ã€ã™ãã«ã¯æ­¢ã¾ã‚Œãªã„ã“ã¨ã‚’è¦šãˆã¦ãŠã“ã†ã€‚" },
            { limit: 20, example: "ãƒœãƒ¼ãƒªãƒ³ã‚°ã®ãƒ¬ãƒ¼ãƒ³ãã‚‰ã„ï¼", text: "ã‚¹ãƒˆãƒ©ã‚¤ã‚¯ã¯æ°—æŒã¡ã„ã„ã‘ã©ã€äººã‚„ç‰©ã«ã‚¹ãƒˆãƒ©ã‚¤ã‚¯ã—ãŸã‚‰å¤§å¤‰ãªã“ã¨ã«â€¦ã€‚" },
            { limit: 30, example: "ã‚·ãƒ­ãƒŠã‚¬ã‚¹ã‚¯ã‚¸ãƒ©ã®å­ä¾›ã¨åŒã˜ãã‚‰ã„ï¼", text: "åœ°çƒæœ€å¤§ã®å‹•ç‰©ã®å­ä¾›ã‚µã‚¤ã‚ºã€‚ãã‚Œã§ã‚‚ã¶ã¤ã‹ã£ãŸã‚‰ã²ã¨ãŸã¾ã‚Šã‚‚ãªã„ã­ã€‚" },
            { limit: 40, example: "ãƒ†ã‚£ãƒ©ãƒã‚µã‚¦ãƒ«ã‚¹ã®å…¨é•·3åŒ¹åˆ†ï¼", text: "æœ€å¼·ã®æç«œãŒ3åŒ¹ä¸¦ã‚“ã è·é›¢ã€‚ã‚‚ã†é€ƒã’åˆ‡ã‚Œãªã„ã‚ˆï¼" },
            { limit: 50, example: "è‡ªç”±ã®å¥³ç¥ï¼ˆåƒæœ¬ä½“ï¼‰ã®é«˜ã•ï¼", text: "ã‚ã®å·¨å¤§ãªå¥³ç¥åƒãŒæ¨ªãŸã‚ã£ã¦ã„ã‚‹ã®ã¨åŒã˜ã€‚ã™ã”ã„è·é›¢ã ï¼" },
            { limit: 60, example: "ãƒ”ã‚µã®æ–œå¡”ã®é«˜ã•ï¼", text: "ã„ã¤å€’ã‚Œã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ã‚¹ãƒªãƒ«ã‚ˆã‚Šã€äº‹æ•…ã®ã»ã†ãŒã‚ˆã£ã½ã©ã‚¹ãƒªãƒªãƒ³ã‚°ã§å±é™ºï¼" },
            { limit: 70, example: "å›½ä¼šè­°äº‹å ‚ã®é«˜ã•ï¼", text: "æ—¥æœ¬ã®ä¸­å¿ƒãŒæ¨ªå€’ã—ã«ãªã£ãŸè·é›¢ã€‚å±…çœ ã‚Šé‹è»¢ãªã‚“ã¦ã¨ã‚“ã§ã‚‚ãªã„ï¼" },
            { limit: 80, example: "ãƒ­ãƒ³ãƒ‰ãƒ³ã®ãƒ“ãƒƒã‚°ãƒ»ãƒ™ãƒ³ã®é«˜ã•ï¼", text: "æ™‚ã‚’åˆ»ã‚€é˜ã®éŸ³ã‚‚èã“ãˆãªã„ã»ã©ã®é«˜é€Ÿã€‚æ™‚é–“ã‚’å·»ãæˆ»ã™ã“ã¨ã¯ã§ããªã„ã‚ˆã€‚" },
            { limit: 90, example: "ã‚µãƒƒã‚«ãƒ¼ã‚³ãƒ¼ãƒˆï¼ˆç¸¦ï¼‰ã®æœ€çŸ­è·é›¢ï¼", text: "ã‚ªãƒ•ã‚µã‚¤ãƒ‰ãƒˆãƒ©ãƒƒãƒ—ã‚‚é€šç”¨ã—ãªã„ã€‚ä¸€ç¬ã§ã‚´ãƒ¼ãƒ«ãƒ©ã‚¤ãƒ³ã‚’å‰²ã£ã¦ã—ã¾ã†å±é™ºãªè·é›¢ã€‚" },
            { limit: 100, example: "100mèµ°ã®ä¸–ç•Œè¨˜éŒ²ä¿æŒè€…ã§ã‚‚9ç§’ä»¥ä¸Šã‹ã‹ã‚‹ï¼", text: "äººé–“ãŒå…¨åŠ›ã§èµ°ã‚‹ã‚ˆã‚Šé€Ÿãã€ã“ã®è·é›¢ã‚’æ»‘èµ°ã—ã¦ã—ã¾ã†ã€‚ã‚‚ã†è‡ªåˆ†ã®åŠ›ã§ã¯ã©ã†ã«ã‚‚ã§ããªã„ï¼" },
            { limit: 120, example: "å¥ˆè‰¯ã®å¤§ä»æ§˜ï¼ˆå°åº§å«ã‚ï¼‰6ä½“åˆ†ï¼", text: "å¤§ä»æ§˜ã‚‚é©šãã»ã©ã®è·é›¢ã€‚å¾Œå…‰ã©ã“ã‚ã‹å±é™ºä¿¡å·ãŒç‚¹æ»…ã—ã¦ã„ã‚‹ï¼" },
            { limit: 140, example: "å¤ªé™½ã®å¡”ã®é«˜ã•2ã¤åˆ†ï¼", text: "èŠ¸è¡“ã¯çˆ†ç™ºã ï¼ãªã‚“ã¦è¨€ã£ã¦ã‚‹å ´åˆã˜ã‚ƒãªã„ã€‚è»ŠãŒå¤§çˆ†ç™ºã™ã‚‹å‰ã«æ­¢ã¾ã£ã¦ï¼" },
            { limit: 160, example: "æ–°å¹¹ç·šã®è»Šä¸¡6ä¸¡åˆ†ï¼", text: "æ—¥æœ¬ã®æŠ€è¡“ã®çµæ™¶ã‚‚ã€æ­¢ã¾ã‚Œãªã‘ã‚Œã°ãŸã ã®é‰„ã®å¡Šã€‚å®‰å…¨æ„è­˜ãŒå¤§äº‹ï¼" },
            { limit: 200, example: "50éšå»ºã¦ã®é«˜å±¤ãƒ“ãƒ«ï¼", text: "ã“ã‚“ãªé«˜ã•ã‹ã‚‰è½ã¡ã‚‹ã“ã¨ã‚’æƒ³åƒã—ã¦ã¿ã¦ã€‚ãã‚Œã¨åŒã˜ãã‚‰ã„ã®è¡æ’ƒãŒå¾…ã£ã¦ã„ã‚‹ï¼" },
            { limit: 250, example: "è±ªè¯å®¢èˆ¹ã‚¯ã‚¤ãƒ¼ãƒ³ãƒ»ã‚¨ãƒªã‚¶ãƒ™ã‚¹ã®å…¨é•·ï¼", text: "å„ªé›…ãªèˆ¹æ—…ã¨ã¯ç¨‹é ã„ã€‚å±é™ºãªèˆªæµ·ã«å‡ºã¦ã„ã‚‹ã®ã¨åŒã˜ã ã‚ˆï¼" },
            { limit: 300, example: "ã‚¨ãƒƒãƒ•ã‚§ãƒ«å¡”ã®å±•æœ›å°ã®é«˜ã•ï¼", text: "ãƒ‘ãƒªã®ç¾ã—ã„æ™¯è‰²ã‚’çœºã‚ã‚‹ä½™è£•ãªã‚“ã¦ãªã„ã€‚ç›®ã®å‰ã«ã‚ã‚‹ã®ã¯å±é™ºã ã‘ï¼" },
            { limit: 340, example: "æ±äº¬ã‚¿ãƒ¯ãƒ¼ã®é«˜ã•ï¼", text: "æ±äº¬ã®ã‚·ãƒ³ãƒœãƒ«ãŒç›®ã®å‰ã«å€’ã‚Œã¦ãã‚‹ã®ã¨åŒã˜ã€‚å»ºè¨­æ™‚ã¯å‘½ç¶±ãªã—ã®ä½œæ¥­å“¡ã‚‚ã„ãŸã¨ã‹â€¦ã€‚ã¾ã•ã«å‘½ãŒã‘ã®å±é™ºåº¦ï¼" },
            { limit: 450, example: "ã‚¨ãƒ³ãƒ‘ã‚¤ã‚¢ã‚¹ãƒ†ãƒ¼ãƒˆãƒ“ãƒ«ã®å°–å¡”ã¾ã§ã®é«˜ã•ï¼", text: "ã‚­ãƒ³ã‚°ã‚³ãƒ³ã‚°ãŒç™»ã£ãŸãƒ“ãƒ«ã¨åŒã˜é«˜ã•ã€‚æ˜ ç”»ã®ãƒ‘ãƒ‹ãƒƒã‚¯ã‚·ãƒ¼ãƒ³ãŒç¾å®Ÿã«ãªã‚‹ï¼" },
            { limit: 500, example: "F1æ—¥æœ¬GPãŒé–‹å‚¬ã•ã‚Œã‚‹éˆ´é¹¿ã‚µãƒ¼ã‚­ãƒƒãƒˆã®ãƒ›ãƒ¼ãƒ ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã®åŠåˆ†ï¼", text: "ãƒ—ãƒ­ãƒ¬ãƒ¼ã‚µãƒ¼ã§ã‚‚ãªã„ã®ã«ã€ã“ã®è·é›¢ã‚’åˆ¶å¾¡ã§ãã‚‹ã‚ã‘ãŒãªã„ï¼" },
            { limit: 640, example: "æ±äº¬ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼ã®é«˜ã•ï¼", text: "æ—¥æœ¬ä¸€é«˜ã„å»ºé€ ç‰©ãŒæ¨ªãŸã‚ã£ã¦ã„ã‚‹ã®ã¨åŒã˜è·é›¢ã€‚å¤©ã«ã‚‚æ˜‡ã‚‹æ°—æŒã¡ã€ã§ã¯ãªãå¤©ã«å¬ã•ã‚Œã‚‹å±é™ºæ€§ï¼" },
            { limit: 830, example: "ãƒ‰ãƒã‚¤ã®ãƒ–ãƒ«ã‚¸ãƒ¥ãƒ»ãƒãƒªãƒ•ã‚¡ã®é«˜ã•ï¼", text: "ä¸–ç•Œä¸€é«˜ã„ãƒ“ãƒ«ãŒç›®ã®å‰ã«ã€‚ã‚‚ã¯ã‚„ç¾å®Ÿæ„Ÿã®ãªã„å±é™ºãªè·é›¢â€¦ğŸ˜¨" },
            { limit: 1000, example: "æ™‚ã‚’é€Ÿ100kmãªã‚‰36ç§’ã§åˆ°é”ã™ã‚‹è·é›¢ï¼", text: "ã‚ã£ã¨ã„ã†é–“ã«ã“ã®è·é›¢ã‚’é€²ã‚“ã§ã—ã¾ã†ã€‚ã»ã‚“ã®ä¸€ç¬ã®æ²¹æ–­ãŒå‘½å–ã‚Šã«ã€‚" },
            { limit: 1610, example: "ã‚¢ãƒ¡ãƒªã‚«ã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ»ã‚²ãƒ¼ãƒˆãƒ»ãƒ–ãƒªãƒƒã‚¸ï¼ˆä¸­å¤®å¾„é–“ï¼‰ã‚ˆã‚Šé•·ã„ï¼", text: "ä¸–ç•Œã§æœ€ã‚‚æœ‰åãªæ©‹ã®ä¸€ã¤ã‚’é£›ã³è¶Šãˆã‚‹è·é›¢ã€‚ã‚‚ã†è»Šã¯ã‚ãªãŸã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ä¸‹ã«ã¯ãªã„ã€‚" },
            { limit: 1690, example: "ãƒ¢ãƒŠã‚³å…¬å›½ã®å›½åœŸã®æ¨ªå¹…ãã‚‰ã„ï¼", text: "ä¸€ã¤ã®å›½ã‚’æ¨ªæ–­ã§ãã¦ã—ã¾ã†ã»ã©ã®è·é›¢ã‚’æ»‘èµ°ã—ã¦ã„ã‚‹ã“ã¨ã«â€¦ã€‚æƒ³åƒã‚’çµ¶ã™ã‚‹å±é™ºæ€§ï¼" },
            { limit: Infinity, example: "F1ãƒã‚·ãƒ³ã®æœ€é«˜é€Ÿãªã‚‰15ç§’ã§èµ°ã‚ŠæŠœã‘ã‚‹è·é›¢ï¼", text: "ã‚‚ã†ä½•ã‚‚ã‹ã‚‚ãŒæ‰‹é…ã‚Œã€‚å®‰å…¨é‹è»¢ãŒã©ã‚Œã ã‘å¤§äº‹ã‹ã€æ”¹ã‚ã¦è€ƒãˆã‚ˆã†ã€‚ğŸ˜±" }
        ];

        // è¨ˆç®—ã¨è¡¨ç¤ºæ›´æ–°ã‚’è¡Œã†é–¢æ•°
        function calculateAndDisplay() {
            const speedKmh = parseFloat(speedInput.value);
            const reactionTime = parseFloat(reactionInput.value);
            const frictionCoeff = parseFloat(surfaceSelect.value);
            const speedMps = speedKmh / 3.6;
            const thinkingDistance = speedMps * reactionTime;
            const brakingDistance = (frictionCoeff > 0) ? (speedMps ** 2) / (2 * frictionCoeff * GRAVITY) : 0;
            const stoppingDistance = thinkingDistance + brakingDistance;

            currentThinkingDistance = thinkingDistance;
            currentBrakingDistance = brakingDistance;
            currentStoppingDistance = stoppingDistance;

            thinkingDistEl.textContent = `${thinkingDistance.toFixed(1)} m`;
            brakingDistEl.textContent = `${brakingDistance.toFixed(1)} m`;
            stoppingDistEl.textContent = `${stoppingDistance.toFixed(1)} m`;

            // Update formulas
            thinkingFormulaEl.textContent = `= ${speedMps.toFixed(1)} m/s Ã— ${reactionTime.toFixed(1)} s`;
            brakingFormulaEl.textContent = `= (${speedMps.toFixed(1)} m/s)Â² / (2 Ã— ${frictionCoeff} Ã— 9.8)`;
            stoppingFormulaEl.textContent = `= ${thinkingDistance.toFixed(1)} m + ${brakingDistance.toFixed(1)} m`;


            const totalDistanceForBar = Math.max(stoppingDistance, 1);
            const thinkingPercentage = (thinkingDistance / totalDistanceForBar) * 100;
            const brakingPercentage = (brakingDistance / totalDistanceForBar) * 100;

            thinkingBar.style.width = `${thinkingPercentage}%`;
            brakingBar.style.width = `${brakingPercentage}%`;
            
            if (thinkingPercentage > 10) thinkingBar.textContent = `${thinkingDistance.toFixed(1)}m`; else thinkingBar.textContent = '';
            if (brakingPercentage > 10) brakingBar.textContent = `${brakingDistance.toFixed(1)}m`; else brakingBar.textContent = '';

            let displayed = false;
            for (const comment of comments) {
                if (stoppingDistance < comment.limit) {
                    commentExampleEl.textContent = `ç´„ ${stoppingDistance.toFixed(0)}m ã¯â€¦ ${comment.example}`;
                    commentTextEl.textContent = comment.text;
                    displayed = true;
                    break;
                }
            }
            if (!displayed || stoppingDistance < 1) {
                 commentExampleEl.textContent = 'å®‰å…¨é‹è»¢ã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†';
                 commentTextEl.textContent = '';
            }
        }
        
        function drawArrow(ctx, fromx, fromy, tox, toy, color, text = '') {
            const headlen = 10;
            const dx = tox - fromx;
            const angle = Math.atan2(toy - fromy, dx);
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(fromx, fromy);
            ctx.lineTo(tox, toy);
            ctx.stroke();

            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(tox, toy);
            ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
            ctx.closePath();
            ctx.fill();

            if (text) {
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 14px "M PLUS 1p"';
                ctx.textAlign = 'center';
                ctx.fillText(text, fromx + dx / 2, fromy - 8);
            }
        }

        function startSimulation() {
            if (currentStoppingDistance < 0.01) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const roadY = canvas.height - 60;
                ctx.strokeStyle = '#A0A0A0'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(0, roadY); ctx.lineTo(canvas.width, roadY); ctx.stroke();
                ctx.save(); ctx.translate(50, roadY - 10); ctx.scale(-1, 1); ctx.font = '30px sans-serif'; ctx.fillText('ğŸš—', 0, 0); ctx.restore();
                ctx.fillStyle = '#FFFFFF'; ctx.font = 'bold 16px "M PLUS 1p"'; ctx.textAlign = 'left'; ctx.fillText('å®‰å…¨ã«åœæ­¢ã—ã¦ã„ã¾ã™ âœ…', 85, roadY - 5);
                ctx.textAlign = 'center'; return;
            }

            const canvasWidth = canvas.width, canvasHeight = canvas.height, roadY = canvasHeight - 60, carY = roadY - 10, markerY = roadY - 30, arrowY = roadY + 20, stoppingArrowY = arrowY + 25;
            const startX = 50, endX = canvasWidth - 50, totalDrawableWidth = endX - startX;
            const pixelsPerMeter = totalDrawableWidth / currentStoppingDistance;
            const thinkingDistPixels = currentThinkingDistance * pixelsPerMeter;
            const speedMps = parseFloat(speedInput.value) / 3.6, reactionTime = parseFloat(reactionInput.value);
            const deceleration = (currentBrakingDistance > 0) ? (speedMps ** 2) / (2 * currentBrakingDistance) : 0;
            const brakingDuration = (deceleration > 0) ? (speedMps / deceleration) : 0;
            const totalSimTime = reactionTime + brakingDuration;

            let startTime = null;

            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsedSeconds = (timestamp - startTime) / 1000;
                ctx.clearRect(0, 0, canvasWidth, canvasHeight);
                ctx.strokeStyle = '#A0A0A0'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(0, roadY); ctx.lineTo(canvasWidth, roadY); ctx.stroke();

                let distanceTraveledMeters;
                if (elapsedSeconds < reactionTime) {
                    distanceTraveledMeters = speedMps * elapsedSeconds;
                } else {
                    const brakingElapsedSeconds = Math.min(elapsedSeconds - reactionTime, brakingDuration);
                    const brakingDistanceTraveled = (speedMps * brakingElapsedSeconds) - (0.5 * deceleration * brakingElapsedSeconds ** 2);
                    distanceTraveledMeters = currentThinkingDistance + brakingDistanceTraveled;
                }
                distanceTraveledMeters = Math.min(distanceTraveledMeters, currentStoppingDistance);
                const carX = startX + distanceTraveledMeters * pixelsPerMeter;

                ctx.font = '30px sans-serif'; ctx.textAlign = 'center';
                if (elapsedSeconds >= 0) ctx.fillText('âš ï¸', startX, markerY);
                if (elapsedSeconds >= reactionTime) ctx.fillText('ğŸš«', startX + thinkingDistPixels, markerY);

                const thinkingEndPos = startX + Math.min(distanceTraveledMeters, currentThinkingDistance) * pixelsPerMeter;
                drawArrow(ctx, startX, arrowY, thinkingEndPos, arrowY, '#60A5FA');
                
                if (elapsedSeconds > reactionTime) {
                     const brakingStartPos = startX + thinkingDistPixels;
                     const brakingEndPos = brakingStartPos + (distanceTraveledMeters - currentThinkingDistance) * pixelsPerMeter;
                     drawArrow(ctx, brakingStartPos, arrowY, brakingEndPos, arrowY, '#F87171');
                }
                drawArrow(ctx, startX, stoppingArrowY, carX, stoppingArrowY, '#FBBF24');
                
                ctx.save(); ctx.translate(carX, carY); ctx.scale(-1, 1); ctx.font = '30px sans-serif'; ctx.fillText('ğŸš—', 0, 0); ctx.restore();

                if (elapsedSeconds < totalSimTime) {
                    animationFrameId = requestAnimationFrame(animate);
                } else {
                    const finalCarX = startX + currentStoppingDistance * pixelsPerMeter;
                    ctx.clearRect(0, 0, canvasWidth, canvasHeight);
                    ctx.strokeStyle = '#A0A0A0'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(0, roadY); ctx.lineTo(canvasWidth, roadY); ctx.stroke();
                    ctx.font = '30px sans-serif'; ctx.textAlign = 'center'; ctx.fillText('âš ï¸', startX, markerY); ctx.fillText('ğŸš«', startX + thinkingDistPixels, markerY);
                    drawArrow(ctx, startX, arrowY, startX + thinkingDistPixels, arrowY, '#60A5FA', `${currentThinkingDistance.toFixed(1)}m`);
                    drawArrow(ctx, startX + thinkingDistPixels, arrowY, finalCarX, arrowY, '#F87171', `${currentBrakingDistance.toFixed(1)}m`);
                    drawArrow(ctx, startX, stoppingArrowY, finalCarX, stoppingArrowY, '#FBBF24', `${currentStoppingDistance.toFixed(1)}m`);
                    ctx.save(); ctx.translate(finalCarX, carY); ctx.scale(-1, 1); ctx.font = '30px sans-serif'; ctx.fillText('ğŸš—', 0, 0); ctx.restore();
                    startSimBtn.disabled = false;
                    startSimBtn.textContent = 'ã‚‚ã†ä¸€åº¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³';
                }
            }
            startSimBtn.disabled = false;
            startSimBtn.textContent = 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢';
            animationFrameId = requestAnimationFrame(animate);
        }

        startSimBtn.addEventListener('click', () => {
            if (startSimBtn.textContent.includes('åœæ­¢')) {
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                startSimBtn.textContent = 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹';
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const roadY = canvas.height - 60;
                ctx.strokeStyle = '#A0A0A0'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(0, roadY); ctx.lineTo(canvas.width, roadY); ctx.stroke();
            } else {
                startSimulation();
            }
        });
        
        // Quiz Logic
        function generatePredictionQuiz() {
            const easySpeeds = [
                { kmh: 36, mps: 10 },
                { kmh: 54, mps: 15 },
                { kmh: 72, mps: 20 },
                { kmh: 90, mps: 25 },
                { kmh: 108, mps: 30 }
            ];
            const easyReactionTimes = [1.0, 1.5, 2.0];

            const speed = easySpeeds[Math.floor(Math.random() * easySpeeds.length)];
            const reactionTime = easyReactionTimes[Math.floor(Math.random() * easyReactionTimes.length)];
            
            const surfaceOptions = [
                { text: 'ä¹¾ã„ãŸé“è·¯ (Î¼=0.8)', value: 0.8 },
                { text: 'æ¿¡ã‚ŒãŸé“è·¯ (Î¼=0.6)', value: 0.6 },
                { text: 'é›ªé“ (Î¼=0.25)', value: 0.25 },
            ];
            const surface = surfaceOptions[Math.floor(Math.random() * surfaceOptions.length)];

            const thinkingDistance = speed.mps * reactionTime;
            const brakingDistance = (speed.mps ** 2) / (2 * surface.value * GRAVITY);
            quizCorrectAnswer = thinkingDistance + brakingDistance;

            quizContentEl.innerHTML = `
                <div class="w-full text-left">
                    <p class="font-bold text-lg mb-2">ã€å•é¡Œã€‘</p>
                    <p>é€Ÿåº¦ <span class="text-yellow-300 font-bold">${speed.kmh} km/h</span>ã€åå¿œæ™‚é–“ <span class="text-yellow-300 font-bold">${reactionTime} ç§’</span>ã§ã€<span class="text-yellow-300 font-bold">${surface.text}</span> ã‚’èµ°è¡Œä¸­ã€å±é™ºã‚’å¯ŸçŸ¥ã—ã¾ã—ãŸã€‚</p>
                    <p class="font-bold mt-2">åœæ­¢è·é›¢ã¯ ç´„ä½•m ã«ãªã‚‹ã‹è¨ˆç®—ã—ã¦ã¿ã‚ˆã†ï¼ï¼ˆå°æ•°ç‚¹ç¬¬ä¸€ä½ã¾ã§ï¼‰</p>
                    
                    <div class="mt-4 p-2 bg-gray-800 rounded-lg">
                        <p class="text-sm font-bold">ãƒ’ãƒ³ãƒˆğŸ’¡</p>
                        <p class="text-xs text-gray-400">1. é€Ÿåº¦ã‚’ km/h ã‹ã‚‰ m/s ã«å¤‰æ› â†’ <span class="font-mono">${speed.kmh} Ã· 3.6 = ${speed.mps} m/s</span></p>
                        <p class="text-xs text-gray-400">2. åˆ¶å‹•è·é›¢ã‚’äºŒæ¬¡é–¢æ•°ã§è¨ˆç®— â†’ <span class="font-mono">(${speed.mps})Â² / (2 Ã— ${surface.value} Ã— 9.8)</span></p>
                        <p class="text-xs text-gray-400">3. ç©ºèµ°è·é›¢ã¨åˆ¶å‹•è·é›¢ã‚’è¶³ã™ï¼</p>
                    </div>

                    <div class="mt-4 flex items-center">
                        <input type="number" id="quiz-answer" class="w-full bg-gray-700 text-white font-bold text-center rounded-lg p-2" placeholder="ç­”ãˆã‚’ã“ã“ã«å…¥åŠ›">
                        <button id="quiz-submit" class="ml-2 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">å›ç­”</button>
                    </div>
                    <div id="quiz-feedback" class="mt-2 text-center font-bold"></div>
                </div>
            `;

            document.getElementById('quiz-submit').addEventListener('click', checkQuizAnswer);
        }
        
        function generateReverseQuiz() {
            const easySpeeds = [
                { kmh: 36, mps: 10 },
                { kmh: 54, mps: 15 },
                { kmh: 72, mps: 20 },
                { kmh: 90, mps: 25 },
                { kmh: 108, mps: 30 }
            ];
            const speed = easySpeeds[Math.floor(Math.random() * easySpeeds.length)];

             const surfaceOptions = [
                { text: 'ä¹¾ã„ãŸé“è·¯ (Î¼=0.8)', value: 0.8 },
                { text: 'æ¿¡ã‚ŒãŸé“è·¯ (Î¼=0.6)', value: 0.6 },
                { text: 'ç ‚åˆ©é“ (Î¼=0.4)', value: 0.4 },
            ];
            const surface = surfaceOptions[Math.floor(Math.random() * surfaceOptions.length)];

            // Calculate braking distance from the clean speed, then round it for the question
            const idealBrakingDistance = (speed.mps ** 2) / (2 * surface.value * GRAVITY);
            const brakingDistanceForQuestion = Math.round(idealBrakingDistance * 10) / 10; // Round to 1 decimal place

            // The correct answer is the original clean speed in km/h
            quizCorrectAnswer = speed.kmh;

            quizContentEl.innerHTML = `
                <div class="w-full text-left">
                    <p class="font-bold text-lg mb-2">ã€å•é¡Œã€‘</p>
                    <p><span class="text-yellow-300 font-bold">${surface.text}</span> ã‚’èµ°è¡Œä¸­ã«æ€¥ãƒ–ãƒ¬ãƒ¼ã‚­ã‚’ã‹ã‘ãŸã¨ã“ã‚ã€åˆ¶å‹•è·é›¢ã¯ <span class="text-yellow-300 font-bold">${brakingDistanceForQuestion} m</span> ã§ã—ãŸã€‚</p>
                    <p class="font-bold mt-2">ãƒ–ãƒ¬ãƒ¼ã‚­ã‚’ã‹ã‘ã‚‹ç›´å‰ã®é€Ÿåº¦ã¯ ç´„ä½•km/h ã ã£ãŸã‹è¨ˆç®—ã—ã¦ã¿ã‚ˆã†ï¼ï¼ˆæ•´æ•°ã§ç­”ãˆã‚ˆã†ï¼‰</p>
                    
                    <div class="mt-4 p-2 bg-gray-800 rounded-lg">
                        <p class="text-sm font-bold">ãƒ’ãƒ³ãƒˆğŸ’¡</p>
                        <p class="text-xs text-gray-400">1. åˆ¶å‹•è·é›¢ã®å…¬å¼ã‹ã‚‰ã€é€Ÿåº¦(m/s)ã‚’é€†ç®—ã—ã‚ˆã†ã€‚</p>
                        <p class="text-xs text-gray-400"><span class="font-mono">é€Ÿåº¦(m/s) = âˆš(2 Ã— ${brakingDistanceForQuestion} Ã— ${surface.value} Ã— 9.8)</span></p>
                        <p class="text-xs text-gray-400">2. é€Ÿåº¦(m/s)ã‚’km/hã«å¤‰æ› â†’ <span class="font-mono">ç­”ãˆ Ã— 3.6</span></p>
                    </div>

                    <div class="mt-4 flex items-center">
                        <input type="number" id="quiz-answer" class="w-full bg-gray-700 text-white font-bold text-center rounded-lg p-2" placeholder="ç­”ãˆã‚’ã“ã“ã«å…¥åŠ›">
                        <button id="quiz-submit" class="ml-2 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">å›ç­”</button>
                    </div>
                    <div id="quiz-feedback" class="mt-2 text-center font-bold"></div>
                </div>
            `;
             document.getElementById('quiz-submit').addEventListener('click', checkQuizAnswer);
        }

        function checkQuizAnswer() {
            const userAnswer = parseFloat(document.getElementById('quiz-answer').value);
            const feedbackEl = document.getElementById('quiz-feedback');
            
            if (isNaN(userAnswer)) {
                feedbackEl.textContent = 'æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                feedbackEl.className = 'mt-2 text-center font-bold text-yellow-400';
                return;
            }

            const margin = quizCorrectAnswer * 0.05; // 5%ã®èª¤å·®ã‚’è¨±å®¹
            if (Math.abs(userAnswer - quizCorrectAnswer) <= margin) {
                feedbackEl.textContent = `æ­£è§£ï¼ğŸ‰ ç´ æ™´ã‚‰ã—ã„ï¼ ç­”ãˆã¯ç´„ ${quizCorrectAnswer.toFixed(1)} ã§ã™ã€‚`;
                feedbackEl.className = 'mt-2 text-center font-bold text-green-400';
            } else {
                feedbackEl.textContent = `ãŠã—ã„ï¼ğŸ˜¢ æ­£è§£ã¯ ç´„ ${quizCorrectAnswer.toFixed(1)} ã§ã™ã€‚ãƒ’ãƒ³ãƒˆã‚’å‚è€ƒã«å†æŒ‘æˆ¦ã—ã¦ã¿ã‚ˆã†ï¼`;
                feedbackEl.className = 'mt-2 text-center font-bold text-red-400';
            }
        }
        
        predictionQuizBtn.addEventListener('click', generatePredictionQuiz);
        reverseQuizBtn.addEventListener('click', generateReverseQuiz);
        
        speedSlider.addEventListener('input', (e) => { speedInput.value = e.target.value; calculateAndDisplay(); });
        speedInput.addEventListener('input', (e) => { speedSlider.value = e.target.value; calculateAndDisplay(); });
        reactionSlider.addEventListener('input', (e) => { reactionInput.value = e.target.value; calculateAndDisplay(); });
        reactionInput.addEventListener('input', (e) => { reactionSlider.value = e.target.value; calculateAndDisplay(); });
        surfaceSelect.addEventListener('change', calculateAndDisplay);
        
        window.onload = calculateAndDisplay;
    </script>
</body>
</html>


